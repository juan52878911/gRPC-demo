{
  "version": 4,
  "terraform_version": "1.5.7",
  "serial": 143,
  "lineage": "d3dd95fe-d2bb-19d1-ef48-eae25c03291d",
  "outputs": {
    "ansible_inventory_path": {
      "value": "./ansible/inventory.ini",
      "type": "string"
    },
    "master_ip": {
      "value": "192.168.64.39",
      "type": "string"
    },
    "master_name": {
      "value": "rancher-master",
      "type": "string"
    },
    "rancher_url": {
      "value": "https://192.168.64.39",
      "type": "string"
    },
    "worker_ips": {
      "value": {
        "worker-1": "192.168.64.38",
        "worker-2": "192.168.64.40"
      },
      "type": [
        "object",
        {
          "worker-1": "string",
          "worker-2": "string"
        }
      ]
    },
    "worker_names": {
      "value": [
        "worker-1",
        "worker-2"
      ],
      "type": [
        "tuple",
        [
          "string",
          "string"
        ]
      ]
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "external",
      "name": "master_ip",
      "provider": "provider[\"registry.terraform.io/hashicorp/external\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "-",
            "program": [
              "bash",
              "-c",
              "multipass info rancher-master --format json | jq -r '.info.\"rancher-master\".ipv4[0] | {\"ip\": .}'"
            ],
            "query": null,
            "result": {
              "ip": "192.168.64.39"
            },
            "working_dir": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "external",
      "name": "worker_ips",
      "provider": "provider[\"registry.terraform.io/hashicorp/external\"]",
      "instances": [
        {
          "index_key": "0",
          "schema_version": 0,
          "attributes": {
            "id": "-",
            "program": [
              "bash",
              "-c",
              "multipass info worker-1 --format json | jq -r '.info.\"worker-1\".ipv4[0] | {\"ip\": .}'"
            ],
            "query": null,
            "result": {
              "ip": "192.168.64.38"
            },
            "working_dir": null
          },
          "sensitive_attributes": []
        },
        {
          "index_key": "1",
          "schema_version": 0,
          "attributes": {
            "id": "-",
            "program": [
              "bash",
              "-c",
              "multipass info worker-2 --format json | jq -r '.info.\"worker-2\".ipv4[0] | {\"ip\": .}'"
            ],
            "query": null,
            "result": {
              "ip": "192.168.64.40"
            },
            "working_dir": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "ansible_inventory",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "[master]\nrancher-master ansible_host=192.168.64.39 ansible_user=ubuntu\n\n[workers]\nworker-1 ansible_host=192.168.64.38 ansible_user=ubuntu\nworker-2 ansible_host=192.168.64.40 ansible_user=ubuntu\n\n[rancher:children]\nmaster\nworkers\n\n[rancher:vars]\nansible_python_interpreter=/usr/bin/python3\nrancher_version=latest\nrancher_server_url=https://192.168.64.39\n",
            "content_base64": null,
            "content_base64sha256": "cSlK/9wT2AQuGBGfKEumD3NbR0CSIygPC2gZTFBoEG8=",
            "content_base64sha512": "Jw6LoznPYwIMmh6M8liEKoQI2gLydIvSZ8TAxEmj559TEKsPBjOL92xhIfDBo+2NKCsk6XlBJhupTdkEEc2RFQ==",
            "content_md5": "ebb1e3245ef71196168046b31b01dbef",
            "content_sha1": "758b5f0c291161cb36ce19bc17d026c209c1d531",
            "content_sha256": "71294affdc13d8042e18119f284ba60f735b47409223280f0b68194c5068106f",
            "content_sha512": "270e8ba339cf63020c9a1e8cf258842a8408da02f2748bd267c4c0c449a3e79f5310ab0f06338bf76c6121f0c1a3ed8d282b24e97941261ba94dd90411cd9115",
            "directory_permission": "0777",
            "file_permission": "0777",
            "filename": "./ansible/inventory.ini",
            "id": "758b5f0c291161cb36ce19bc17d026c209c1d531",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [],
          "dependencies": [
            "data.external.master_ip",
            "data.external.worker_ips",
            "local_file.cloudinit_master",
            "local_file.cloudinit_worker",
            "multipass_instance.rancher_master",
            "multipass_instance.rancher_workers",
            "null_resource.create_generated_dir"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "cloudinit_master",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "#cloud-config\npackage_update: true\npackage_upgrade: true\n\nusers:\n  - name: ubuntu\n    groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo,docker\n    shell: /bin/bash\n    lock_passwd: false\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqAVz93mLHXkCZYrAAAdK3HKtYwF69aLtG7dorfSH4vKbhUC7XygNB2h5EuMuewlK/ILb4ASerxLjmhfZBGpT04cQpFT3+TrocfN1fjjdLlClaV7SK38Buf9yDdLkrZboFFHEb7FtCN4vjQp1Btl3j8gDEfT2Z/cwC0YUqHj/PSE136Dc0SQxl+1C0rPRQ2V1Tk10CRzDov4ltKSMoLwlgMm8b9YwxT60fzDzLNrcFzeWzLyPgShsJQw7C6gREsookpa6FCg591cx6fOCkQge5p9KJOahU8lTDxV95b2sy8BnMXDaSPQAYA/ejvLVrzeSxngaiasTL72RH4oehos7whyGgiJOlf8C6dE6GaCVe7O1pOuh/RLpImGMkmxFErkvVRibQZs4+3xsUZj0b5zgVO8pSh5+shAETpmCd20e7NwApR2db7keoUugxE4oo98XJCN/hwxwAOF+4IhAXLQZjudvo4NFcsuKohSOZv2GjHIbbDLdOVm3s1xeSwtP/SQZjGYU7kRfmB+kSihiaIbU8XjdI4jToaU7GwLIfmzJYuQWagR4YU2b/AteOuo1knBZne/VJ60Zqoew3zBI84A9k4y/y/ZqSExMWNi+YZmHY8Y+e6qzwes5VapkSOefrP2eeswSFsKxrwfDXRv19EngOce33Fqrr1SCXtQbL1GJvqw== JPBEDBEN@JPBEDBEN-K3YQ5HYD09\n\n\nssh_deletekeys: false\nssh_pwauth: false\n\n# Instalar dependencias básicas y Docker\npackages:\n  - apt-transport-https\n  - ca-certificates\n  - curl\n  - gnupg\n  - lsb-release\n  - software-properties-common\n  - python3\n  - python3-pip\n\n# Configurar límites del sistema para Kubernetes\nbootcmd:\n  - modprobe br_netfilter || true\n  - echo 'net.bridge.bridge-nf-call-iptables = 1' \u003e\u003e /etc/sysctl.conf || true\n  - echo 'net.ipv4.ip_forward = 1' \u003e\u003e /etc/sysctl.conf\n  - sysctl -p || true\n\nwrite_files:\n  - path: /etc/docker/daemon.json\n    content: |\n      {\n        \"log-driver\": \"json-file\",\n        \"log-opts\": {\n          \"max-size\": \"100m\",\n          \"max-file\": \"3\"\n        }\n      }\n\n# Comandos a ejecutar durante la inicialización\nruncmd:\n  # Instalar Docker (compatible con ARM64 y AMD64)\n  - |\n    ARCH=$(dpkg --print-architecture)\n    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n    echo \"deb [arch=$ARCH signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\n    apt-get update\n    apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n    systemctl enable docker\n    systemctl start docker\n    usermod -aG docker ubuntu\n\n  # Crear directorios necesarios\n  - mkdir -p /opt/rancher\n  - chown ubuntu:ubuntu /opt/rancher\n\nfinal_message: \"Master node dependencies installed after $UPTIME seconds. Ready for Ansible configuration.\"",
            "content_base64": null,
            "content_base64sha256": "bDmDi2/7W12K2MaC7TpqH4bZjpsjKNC5IvsNUTs8G3E=",
            "content_base64sha512": "nmO6VoTcAG55IUMrJBCxF2T/h0+AGvifhNkQnfnh1R+5Z301k0he1CAICyWNomOhkrc98jzyg6FF0wXPHi16kw==",
            "content_md5": "569522c33988dcf7a72512c5b96914ee",
            "content_sha1": "8d89c438f70cb5b1b7d859057578dd5625d6e80e",
            "content_sha256": "6c39838b6ffb5b5d8ad8c682ed3a6a1f86d98e9b2328d0b922fb0d513b3c1b71",
            "content_sha512": "9e63ba5684dc006e7921432b2410b11764ff874f801af89f84d9109df9e1d51fb9677d3593485ed420080b258da263a192b73df23cf283a145d305cf1e2d7a93",
            "directory_permission": "0777",
            "file_permission": "0777",
            "filename": "./cloud-init-scripts/generated/cloud-init-master.yaml",
            "id": "8d89c438f70cb5b1b7d859057578dd5625d6e80e",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [],
          "dependencies": [
            "null_resource.create_generated_dir"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "local_file",
      "name": "cloudinit_worker",
      "provider": "provider[\"registry.terraform.io/hashicorp/local\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "content": "#cloud-config\npackage_update: true\npackage_upgrade: true\n\nusers:\n  - name: ubuntu\n    groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo,docker\n    shell: /bin/bash\n    lock_passwd: false\n    sudo: ALL=(ALL) NOPASSWD:ALL\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCqAVz93mLHXkCZYrAAAdK3HKtYwF69aLtG7dorfSH4vKbhUC7XygNB2h5EuMuewlK/ILb4ASerxLjmhfZBGpT04cQpFT3+TrocfN1fjjdLlClaV7SK38Buf9yDdLkrZboFFHEb7FtCN4vjQp1Btl3j8gDEfT2Z/cwC0YUqHj/PSE136Dc0SQxl+1C0rPRQ2V1Tk10CRzDov4ltKSMoLwlgMm8b9YwxT60fzDzLNrcFzeWzLyPgShsJQw7C6gREsookpa6FCg591cx6fOCkQge5p9KJOahU8lTDxV95b2sy8BnMXDaSPQAYA/ejvLVrzeSxngaiasTL72RH4oehos7whyGgiJOlf8C6dE6GaCVe7O1pOuh/RLpImGMkmxFErkvVRibQZs4+3xsUZj0b5zgVO8pSh5+shAETpmCd20e7NwApR2db7keoUugxE4oo98XJCN/hwxwAOF+4IhAXLQZjudvo4NFcsuKohSOZv2GjHIbbDLdOVm3s1xeSwtP/SQZjGYU7kRfmB+kSihiaIbU8XjdI4jToaU7GwLIfmzJYuQWagR4YU2b/AteOuo1knBZne/VJ60Zqoew3zBI84A9k4y/y/ZqSExMWNi+YZmHY8Y+e6qzwes5VapkSOefrP2eeswSFsKxrwfDXRv19EngOce33Fqrr1SCXtQbL1GJvqw== JPBEDBEN@JPBEDBEN-K3YQ5HYD09\n\n\nssh_deletekeys: false\nssh_pwauth: false\n\n# Instalar dependencias básicas y Docker\npackages:\n  - apt-transport-https\n  - ca-certificates\n  - curl\n  - gnupg\n  - lsb-release\n  - software-properties-common\n  - python3\n  - python3-pip\n  - vim\n  - wget\n  - htop\n\n# Configurar límites del sistema para Kubernetes\nbootcmd:\n  - modprobe br_netfilter || true\n  - modprobe overlay || true\n  - echo 'net.bridge.bridge-nf-call-iptables = 1' \u003e\u003e /etc/sysctl.conf || true\n  - echo 'net.ipv4.ip_forward = 1' \u003e\u003e /etc/sysctl.conf\n  - echo 'net.bridge.bridge-nf-call-ip6tables = 1' \u003e\u003e /etc/sysctl.conf || true\n  - sysctl -p || true\n\n# Archivos de configuración\nwrite_files:\n  - path: /etc/docker/daemon.json\n    content: |\n      {\n        \"log-driver\": \"json-file\",\n        \"log-opts\": {\n          \"max-size\": \"100m\",\n          \"max-file\": \"3\"\n        },\n        \"storage-driver\": \"overlay2\"\n      }\n    permissions: '0644'\n\n  - path: /etc/sysctl.d/99-kubernetes.conf\n    content: |\n      net.bridge.bridge-nf-call-iptables = 1\n      net.bridge.bridge-nf-call-ip6tables = 1\n      net.ipv4.ip_forward = 1\n      vm.swappiness = 0\n    permissions: '0644'\n\n  - path: /etc/modules-load.d/k8s.conf\n    content: |\n      overlay\n      br_netfilter\n    permissions: '0644'\n\n# Comandos a ejecutar durante la inicialización\nruncmd:\n  # Cargar módulos del kernel necesarios\n  - modprobe overlay || true\n  - modprobe br_netfilter || true\n\n  # Instalar Docker (compatible con ARM64 y AMD64)\n  - |\n    ARCH=$(dpkg --print-architecture)\n    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n    echo \"deb [arch=$ARCH signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | tee /etc/apt/sources.list.d/docker.list \u003e /dev/null\n    apt-get update\n    apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n    systemctl enable docker\n    systemctl start docker\n    usermod -aG docker ubuntu\n\n  # Crear directorios necesarios\n  - mkdir -p /var/log/rancher\n  - chown ubuntu:ubuntu /var/log/rancher\n\nfinal_message: \"Worker node dependencies installed after $UPTIME seconds. Ready for Ansible configuration.\"",
            "content_base64": null,
            "content_base64sha256": "gCmVHtMyS5eH8xRB9WzZKBv3KXLHl6WPpywNHL4K4tk=",
            "content_base64sha512": "xs6UqxpJUTcH58grO+uHyhb6o9GGtTdSxue2Ogk38RgdMrCd9/FIZ6GZliaZyB9SZVsO1EAp/vI/CFwgT+VwCw==",
            "content_md5": "6f5b75c9838c4e69699fa565b1b25a29",
            "content_sha1": "097cfe0de19dbd5f6f8eeca75b5da563b7406b69",
            "content_sha256": "8029951ed3324b9787f31441f56cd9281bf72972c797a58fa72c0d1cbe0ae2d9",
            "content_sha512": "c6ce94ab1a49513707e7c82b3beb87ca16faa3d186b53752c6e7b63a0937f1181d32b09df7f14867a199962699c81f52655b0ed44029fef23f085c204fe5700b",
            "directory_permission": "0777",
            "file_permission": "0777",
            "filename": "./cloud-init-scripts/generated/cloud-init-worker.yaml",
            "id": "097cfe0de19dbd5f6f8eeca75b5da563b7406b69",
            "sensitive_content": null,
            "source": null
          },
          "sensitive_attributes": [],
          "dependencies": [
            "null_resource.create_generated_dir"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "multipass_instance",
      "name": "rancher_master",
      "provider": "provider[\"registry.terraform.io/larstobi/multipass\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cloudinit_file": "./cloud-init-scripts/generated/cloud-init-master.yaml",
            "cpus": 2,
            "disk": "20G",
            "image": "22.04",
            "memory": "4G",
            "name": "rancher-master"
          },
          "sensitive_attributes": [],
          "dependencies": [
            "local_file.cloudinit_master",
            "null_resource.create_generated_dir"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "multipass_instance",
      "name": "rancher_workers",
      "provider": "provider[\"registry.terraform.io/larstobi/multipass\"]",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 0,
          "attributes": {
            "cloudinit_file": "./cloud-init-scripts/generated/cloud-init-worker.yaml",
            "cpus": 2,
            "disk": "10G",
            "image": "jammy",
            "memory": "2G",
            "name": "worker-1"
          },
          "sensitive_attributes": [],
          "dependencies": [
            "local_file.cloudinit_worker",
            "null_resource.create_generated_dir"
          ]
        },
        {
          "index_key": 1,
          "schema_version": 0,
          "attributes": {
            "cloudinit_file": "./cloud-init-scripts/generated/cloud-init-worker.yaml",
            "cpus": 2,
            "disk": "10G",
            "image": "jammy",
            "memory": "2G",
            "name": "worker-2"
          },
          "sensitive_attributes": [],
          "dependencies": [
            "local_file.cloudinit_worker",
            "null_resource.create_generated_dir"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "create_generated_dir",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "8125144926609471162",
            "triggers": null
          },
          "sensitive_attributes": []
        }
      ]
    }
  ],
  "check_results": null
}
